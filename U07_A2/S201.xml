<?xml version="1.0"?>
<slide id="0701f2dd-00cb-4ab7-a271-82db4aa97ac8" title="Задание A2-1. Amend commit" xmlns="https://ulearn.me/schema/v2">

<markdown>
# Введение

Amend commit — команда, которая позволяет дополнить последний коммит дополнительными изменениями. В задании про скрытый конфликт правки после слияния можно было добавить непосредственно в коммит слияния с помощью этой команды. Конечно, это был бы уже другой коммит слияния, ведь коммиты неизменны, но это уже детали.

На первый взгляд может показаться, что сейчас уже ничего не исправить — ветка `rerefs-feature` влита, после слияния появился коммит с сообщением `Fix after merge rerefs-feature`. Но с помощью команды reset в режиме soft можно сделать и не такое!

# Сохранение прогресса

Сейчас подходящий момент, чтобы сохранить текущий прогресс по выполнению заданий. Для этого достаточно сделать копию папки `ulearn-git-guide`.

Рабочий каталог и репозиторий находятся внутри этой скопированной папки, так что в любой момент можно будет вернуться к сохраненному состоянию. Для этого надо либо переключиться на копию папки, заменить все содержимое папки `ulearn-git-guide` на содержимое папки с сохраненным состоянием.

# Шаг 1

Для начала надо «отменить» последний коммит с помощью soft reset. Напомню, что это действие в точности соответствует алиасу `undo`, но можешь использовать любой другой способ выполнить soft reset.

Итак, убедись, что `main` является текущей веткой, а коммит с сообщением `Fix after merge rerefs-feature` является текущим коммитом. И выполни soft reset на предыдущий коммит.

&gt; Отменить последний коммит в терминале можно командой `git reset --soft HEAD^`

&gt; Чтобы отменить последний коммит в графическом интерфейсе, надо выделить предыдущий коммит, открыть контекстное меню, найти команду reset и выполнить ее. Когда графический интерфейс предоставит выбор режима hard, mixed или soft, надо выбрать soft.

# Шаг 2

После предыдущего шага в индексе уже находится та версия Гайда, которая должна была быть в коммите слияния. Поэтому остается только дополнить коммит слияния с помощью amend commit.

*Если говорить максимально точно, остается заменить коммит слияния на новый коммит, который будет содержать версию Гайда из Commit index, но при этом сохранит связи с родителями текущего коммита слияния. Именно это и сделает amend commit.*

Итак, выполни в терминале команду `git commit --amend --no-edit`. В этом варианте команды не придется писать новое сообщение к коммиту, потому что автоматически будет использовано сообщение из коммита слияния.

# Шаг 3

Убедись, что в результате твоих действий в дереве коммитов появился ровно один новый коммит, объединяющий две ветви изменений.

При этом старый коммит слияния и коммит с сообщением `Fix after merge rerefs-feature` должны быть до сих пор видны. Ты же понимаешь, почему они до сих пор видны?

# Результат

*Теперь история коммитов должна выглядеть так:*
</markdown>
<galleryImages>
    <image>images\a2-1-finish.png</image>
</galleryImages>

</slide>
